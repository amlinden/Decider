<!DOCTYPE html>
 <head>
    <meta charset="utf-8">
    <!-- måste komma först, de nedan -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css'>
    <link rel='stylesheet prefetch' href='https://fonts.googleapis.com/icon?family=Material+Icons'>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.14/angular.min.js'></script>    
    <script type="text/javascript" src="lib/jquery-2.1.1.min.js"></script>
    <script src="https://www.google.com/jsapi"></script>

<!-- for the map -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB7Z2r8SM1mMa-tO4_6jdqu7o5LaJ0E0kA" defer>
    </script>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap.css">

<!-- saved from url=(0047)http://evothings.com/demos/dome_pics/index.html -->
    <html class="ui-mobile"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!--<base href="http://evothings.com/demos/dome_pics/index.html">--><base href=".">
    <meta name="viewport" content="width=device-width, user-scalable=no,
        shrink-to-fit=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">

    <title>Decider</title>
    <script>
    // Redirect console.log to Evothings Workbench, so you can see data under 'Tools'
    if (window.hyper && window.hyper.log) { hyper.log = console.log }
    </script>
</head>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<body class="ui-mobile-viewport ui-overlay-a"><div data-role="page" data-url="/demos/dome_pics/index.html" tabindex="0" class="ui-page ui-page-theme-a ui-page-active" style="min-height: 900px;">
 
<style>
    
    .img-circle {
    border-radius: 50%;
}
body{
  /*background: #99CCCC;*/
  background: url(bakgrund3.jpg) no-repeat;
  width:100%;
}

.ghost-button-rounded-corners {
  display: inline-block;
  width: 200px;
  padding: 8px;
  background-color: transparent;
  color: #fff;
  border: 1px solid lightblue;
  border-radius: 5px;
  text-align: center;
  outline: none;
  text-decoration: none;
}
.ghost-button-rounded-corners:hover,
.ghost-button-rounded-corners:active {
  background-color: lightblue;
  color:#fff;
  
}

.ghost-button {
  display: inline-block;
  width: 20px;
  padding: 8px;
  background-color: transparent;
  color: #fff;
  border: 1px solid transparent;
  border-radius: 5px;
  text-align: center;
  outline: none;
  text-decoration: none;
}
.ghost-button:hover,
.ghost-button:active {
  background-color: transparent;
  color:lightblue;
  
}

h1 {
    font-size: 40px;
    font-family: verdana;
    color:lightblue;
}
h2 {
    font-size: 15px;
    font-family: verdana;
    color:lightblue;
    margin-left: 5%;
    

}

.glyphicon-road {
  color:lightblue; 
  font-size: 100px; 
  margin-left: 35%;
  margin-right: 50%; 

}
#map {
    height: 500px;
    width: 100%;
}
</style>

<body ng-app= "myApp">

<!-- first page icon -->
  <div class="container" style="width:100%;" ng-controller="showHideCtrl">
    </br>
    <button ng-hide="back" ng-click="goBack()" class="ghost-button" >
        <span class="glyphicon glyphicon-chevron-left"></span>
    </button>
    </br>
    <p><span class="glyphicon glyphicon-road" ></span></p>
    <h2>- We make it easier by helping you choose!</h2></br></br></br>
    <!-- Go back-button, funkar inte med hide ännu --> 

    
  <!-- first button, on click goes to shake me page -->
  <button ng-hide="menuBtn1" ng-click="shakePage()" type="button" class="ghost-button-rounded-corners" >Help me decide</button> 

  <!-- Here the user makes choices so that the shake me will decide choice -->
  <form ng-hide="showForm" action="" onsubmit="return false;">

  <textarea class="form-control" rows="1" id="choicelist" cols=500>
  </textarea><br><br>

  <input type="button" value="Choose" class="ghost-button-rounded-corners" onclick="randchoose(); return false;"><br><br>
  <input id="result" type="value" value="" readonly="readonly">
  </br><span style="color:lightblue; font-size: 20px;" > Shake me</span>
  </form>

  <!-- second button on the first page, on click, takes you to get inspiration page -->
  
  </br></br>
      <button ng-hide="menuBtn2" ng-click="getInspo()" type="button" class="ghost-button-rounded-corners" >Shuffle</button>

  <div ng-hide="showInspo">
      <span style="color:lightblue; font-size: 40px;" >Find</br>
      me</br>
      some</span>
      </br>
      <button ng-click="inspoChoice()" class="ghost-button-rounded-corners" >
      <span class="glyphicon glyphicon-chevron-right"></span>
      </button>

   <div ng-hide="showChoices" ng-controller="mapCtrl">




      </br>
      <!-- <div ng-controller="mapCtrl"> -->
        

      <button ng-click="showCafe(); allMap()"class="ghost-button-rounded-corners">Coffee</button>
      </br></br>

      <button class="ghost-button-rounded-corners">Beer</button> </br>
        
        <span style="color:lightblue; font-size: 40px;" id="namn"></span></br>
        <span style="color:lightblue; font-size: 15px;" id="order"></span></br>
        <span style="color:lightblue; font-size: 20px;" ng-hide="mapBtn" ng-click= "allMap()" id="dist"></span>

        <button ng-hide="mapBtn" ng-click="showMap(); allMap()" class="ghost-button">
        <span class= "glyphicon glyphicon-map-marker"></span></button>
      
      </div>

      <div ng-hide="map" id="map"></div>
        
        
      

  <!-- Home button -->
  </br></br>
  <button ng-hide="homeBtn" type="button" class="ghost-button-rounded-corners">
      <span class="glyphicon glyphicon-home"></span>
  </button></br></br></br></br>
      </div>
  </div>


<script>
var app = angular.module('myApp', []);

  app.controller('showHideCtrl', function($scope) {

    $scope.latestShowed= [];
    $scope.showInspo   = true;
    $scope.showChoices = true;
    $scope.showForm    = true;
    $scope.homeBtn     = true;
    $scope.menuBtn1    = false;
    $scope.menuBtn2    = false;
    $scope.back        = true;
    $scope.mapBtn      = true;
    $scope.map         = true;

    $scope.goBack = function() {   
      $scope.back       = !$scope.back;

      for (var i=0; i< $scope.latestShowed.length; i++){
        //ALTERNATIV MED PARSE (glöm ej att sätta in $parse i controllern)
        //$scope.latestShowed[i]=false;
        // var varible = $parse($scope.latestShowed[i])
        // varible.assign($scope,!$scope.varible)
        // console.log(varible);

        //ALTERNATIV UTAN PARSE
        var varible = $scope.latestShowed[i]
        $scope[varible] = !$scope[varible]
         
      }
      $scope.showChoices = true;
      $scope.showInspo   = true;

    };
    $scope.getInspo = function() {
        $scope.back      = false;

        $scope.latestShowed.push("menuBtn1","menuBtn2");

        $scope.showInspo = !$scope.showInspo;
        $scope.showChoices = true;
        $scope.menuBtn1 = true;
        $scope.menuBtn2 = true;
    };
    $scope.inspoChoice = function() {
      $scope.showChoices = !$scope.showChoices;
      $scope.mapBtn     = true;


    };
    $scope.shakePage = function() {
        $scope.back       = false;
        $scope.latestShowed.push("menuBtn1","menuBtn2");
        $scope.showForm = !$scope.showForm;
        $scope.showInspo = true;
        $scope.menuBtn1 = true;
        $scope.menuBtn2 = true;
    };


    $scope.showCafe = function() {
      $scope.back       = false;
      $scope.mapBtn     = false;
      
    };

    $scope.showMap = function() {
      $scope.map      = false;
      
    };
});


  function randchoose() {
    choices = document.getElementById("choicelist").value.split("\n");
    if (choices.length == 0) return;
    document.getElementById("result").value = choices[Math.floor(Math.random() * choices.length)];
  }


// app.controller('inspirationCtrl', function($scope) {
//     $scope.showInspo = true;
//     $scope.getInspo = function() {
//         $scope.showInspo = !$scope.showInspo;
//         $scope.showChoices = true;
//         $scope.menuBtn2 = true;
//     };
//     $scope.showChoices = true;  
//     $scope.toggleChoice = function() {
//       $scope.showChoices = !$scope.showChoices;
//     };
// }); 

// app.controller('shakeMeCtrl', function($scope) {
//     $scope.showForm = true;
//     $scope.toggle = function() {
//         $scope.showForm = !$scope.showForm;
        
//         $scope.showInspo = true;
//         $scope.menuBtn1 = true;
//     };
// }); 

// function randchoose() {
//   choices = document.getElementById("choicelist").value.split("\n");
//   if (choices.length == 0) return;
//   document.getElementById("result").value = choices[Math.floor(Math.random() * choices.length)];
// }
app.controller('mapCtrl', function($scope){ 
  $scope.allMap = function(){
    $scope.cafes = [
        {
            title: "Café Saturnus",
            order: "Latte and cinnamon bun",
            koordinat: {lat: 59.339491, lng: 18.068747}
        },
            {
            title: "Sturekatten",
            order: "Coffee and apple pie",
            koordinat: {lat: 59.334771, lng: 18.074969}
        },
        {
            title: "Kaffeverket",
            order: "Machalatte and chia pudding",
            koordinat: {lat: 59.341405, lng: 18.038072}
        }
    ];
    $scope.bars = [
        {
            title: "Bierhaus",
            order: "Kaffel Kölsch",
            koordinat: {lat: 59.340164, lng: 18.061868}
        },
            {
            title: "The Capital",
            order: "Cosmopolitan",
            koordinat: {lat: 59.340164, lng: 18.061868}
        },
        {
            title: "Komendören",
            order: "Lemonade",
            koordinat: {lat: 59.339195, lng: 18.077564}
        }
    ];
    $scope.responses = new Array();
    $scope.distances = new Array();
    $scope.directionsService = new google.maps.DirectionsService;
    $scope.directionsDisplay = new google.maps.DirectionsRenderer;     
    var mapOptions = {
      center: {lat: 59.329324, lng: 18.068581},
      zoom: 15,
      tilt: 45,
    }
    $scope.map = new google.maps.Map(document.getElementById('map'), mapOptions);
    $scope.directionsDisplay.setMap($scope.map);


    $scope.calculateRoute = function(directionsService, directionsDisplay,pos){ 
        for (var i=0; i<$scope.cafes.length; i++) {
            console.log(i)
            console.log($scope.cafes[i].title, $scope.cafes[i].koordinat)
             
          directionsService.route({
            origin: pos,
            destination: $scope.cafes[i].koordinat,
            travelMode: google.maps.TravelMode.WALKING
          }, function(response, status) {
                console.log("hej hej")
                if (status === google.maps.DirectionsStatus.OK) {
                  $scope.distances.push(response.routes[0].legs[0].distance.value);
                  $scope.responses.push(response);
                } else {
                  window.alert('Directions request failed due to ' + status);
                }
                        
                if (i==$scope.distances.length){
                    console.log($scope.distances)
                    $scope.shortestDist = Math.min.apply(Math,$scope.distances);
                    console.log($scope.responses)
                    for (i in $scope.responses){
                        if ($scope.responses[i].routes[0].legs[0].distance.value == $scope.shortestDist){
                            directionsDisplay.setDirections($scope.responses[i]);
                            $scope.closestResp = $scope.responses[i];
                            
                        }
                    }
                }
                if (i=2){
                  $scope.displayRoute($scope.closestResp);
              }
            });
        }
        console.log("shortestDist", $scope.shortestDist)
    }

    $scope.displayRoute = function(closestResp){ 
      console.log(closestResp)
      for (i in $scope.cafes){
        if ($scope.cafes[i].koordinat == closestResp.request.destination){
          console.log($scope.cafes[i].title)
          console.log(closestResp.routes[0].legs[0].distance.text)
          document.getElementById("dist").innerHTML = closestResp.routes[0].legs[0].distance.text;
          document.getElementById("namn").innerHTML = $scope.cafes[i].title;
          document.getElementById("order").innerHTML = "Order: " + $scope.cafes[i].order;
        }
      } 
      console.log($scope.cafes)
    }


    $scope.getloc = function(){
        if (navigator.geolocation) {
            console.log("hämtar location")
            navigator.geolocation.getCurrentPosition(function(position) {
            $scope.pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
                };
            console.log($scope.pos)
            $scope.calculateRoute($scope.directionsService, $scope.directionsDisplay,$scope.pos)
            });

        }
    }

    $scope.getloc();
};

});
</script> 


</body>
</html>